<!DOCTYPE html>
<html lang="en">
<head>
    <title>Beautiful Timetables</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">


    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.css' rel='stylesheet'/>


    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="{{ url_for('static', filename='jquery.sticky-kit.min.js') }}"></script>

    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v3.0.3/mapbox-gl-directions.js'></script>
    <link rel='stylesheet'
          href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v3.0.3/mapbox-gl-directions.css'
          type='text/css'/>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <script>


        mapboxgl.accessToken = 'pk.eyJ1IjoiZ2FieWFudG92YSIsImEiOiJjaXlhNXRsOW8wMDIyMzNxcDdxdTk3dGcwIn0.gNNtUvGPe9zNblVthu__Yg';

        $(document).ready(function () {

            $(".dayOfTheWeek").stick_in_parent({
                offset_top: 155
            });


            $('.modal').on('shown.bs.modal', function () {

                //map.invalidateSize();
                //map.resize();
            });


        });

        $(window).on("scroll touchmove", function () {
            $('#header').toggleClass('collapse', $(document).scrollTop() > 0);
        });


        // Entry every filtering class below.
        var $chkbxFilter_tags = ['AI', 'CG', 'CS', 'SE', 'unclassified'];

        // Entry the block element that will be filtered below.
        var $chkbxFilter_blocks = ['.course-box']

    </script>


</head>
<body>


<!--

COURSE_DICT:

{
u'STN': {
             'course': u'Social and Technological Networks',
             'credits': u'10',
             'course_url': 'http://course.inf.ed.ac.uk/stn',
             'year': u'4'
        }
}

CONTENT_DICT:

{
u'Fri': [
            [
                {
                    'course_acr': u'DS',
                    'course_details': u' Teviot LT, MEDS',
                    'course_year': u'4'
                },
                {
                    'course_acr': u'CT',
                    'course_details': u' Meadows LT, MEDS',
                    'course_year': u'3'
                }
             ],

             [
                {
                    'course_acr': u'MLPR',
                    'course_details': u' LHB, DHT',
                    'course_year': u'4'
                }
             ],

             [
             ]
         ]
}




//-->

<div role="tabpanel">


    <div id="header">
        <img id="logo"
             src="https://upload.wikimedia.org/wikipedia/en/c/ca/University_of_Edinburgh_School_of_Informatics_logo.jpg">
        <h2>Lecture Timetable 2016-2017</h2>
        <div id="select" class="tags">

            <label class="selected">
                <input type="radio" id="all">
                ALL
            </label>
            <label for="AI">
                <input type="checkbox" name="subject" value="AI" id="AI" class="sort"/>
                AI
            </label>
            <label for="CG">
                <input type="checkbox" name="subject" value="CG" id="CG" class="sort"/>
                CG
            </label>
            <label for="CS">
                <input type="checkbox" name="subject" value="CS" id="CS" class="sort"/>
                CS
            </label>
            <label for="SE">
                <input type="checkbox" name="subject" value="SE" id="SE" class="sort"/>
                SE
            </label>
            <label for="unclassified">
                <input type="checkbox" name="subject" value="unclassified" id="unclassified" class="sort"/>
                Unclassified
            </label>
            <label>
                <input type="checkbox" name="year" value="year1" id="year1" class="sort"/>
                Year 1
            </label>
            <label>
                <input type="checkbox" name="year" value="year2" id="year2" class="sort"/>
                Year 2
            </label>
            <label>
                <input type="checkbox" name="year" value="year3" id="year3" class="sort"/>
                Year 3
            </label>
            <label>
                <input type="checkbox" name="year" value="year4" id="year4" class="sort"/>
                Year 4
            </label>
        </div>
        <div id="whatfilters"></div>
        <ul class="nav nav-tabs">
            <li class="active">
                <a href="#0" data-toggle="tab">Semester 1</a>
            </li>
            <li><a href="#1" data-toggle="tab">Semester 2</a>
            </li>
        </ul>

        <table id="header-table" class="table table-hover">
            <thead>
            <tr>
                <th></th>
                {% for time in TIMES_LIST %}
                    <th>{{ time }}</th>
                {% endfor %}
            </tr>
            </thead>
        </table>
    </div>


    <div class="container">

        <div class="tab-content" id="result">
            <div role="tabpanel" class="tab-pane fade in active" id="basics">


                <!--<div id='map-one' class='map'> </div>-->
                <!--<div id='map-one' class='map'> </div>-->
            </div>
            {% for x in range(2) %}
                <div class="semester tab-pane active" id="{{ x }}">
                    <table class="table">
                        <tbody>

                        {% for day in WEEKDAYS %}
                            <tr>

                                <td><p class="dayOfTheWeek">{{ day }}</p></td>

                                {% set timeCounter = 0 %}
                                {% for hourSlot in CONTENT_DICT[x][day[0:3]] %}

                                    <div>
                                        <td>
                                            {% for courseDict in hourSlot %}


                                                {#{% if courseDict['course_acr'] in COURSE_DICT %}{{ COURSE_DICT[courseDict['course_acr']]['year'] }}{% if COURSE_DICT[courseDict['course_acr']]['types'] is defined %}{% for type in COURSE_DICT[courseDict['course_acr']]['types'] %}{{ type }}{% else %}{{ 'unclassified' }}{% endfor %}{% endif %}{% endif %}#}

{#                                                <div data-category="year{% if courseDict['course_acr'] in COURSE_DICT %}{{ COURSE_DICT[courseDict['course_acr']]['year'] }} {% for type in COURSE_DICT[courseDict['course_acr']]['types'] %}  {% if type not in COURSE_DICT[courseDict['course_acr']]['types'] %}#}
                                                <div data-category="year{% if courseDict['course_acr'] in COURSE_DICT %}{{ COURSE_DICT[courseDict['course_acr']]['year'] }} {% if COURSE_DICT[courseDict['course_acr']]['types'] is defined %} {% for type in COURSE_DICT[courseDict['course_acr']]['types'] %} {{ type }} {% else %} {{ 'unclassified' }} {% endfor %}{% endif %}{% endif %} "
                                                     class="well well-sm pointer course-box subject"
                                                     data-toggle="modal"
                                                     data-target="#{{ courseDict['course_acr'] + '-' + day }}-modal">
                                                    <p class="course_acr"><b>{{ courseDict["course_acr"] }}</b></p>
                                                    {% if courseDict["course_acr"] in COURSE_DICT %}
                                                        <p class="course_name">{{ (COURSE_DICT[courseDict["course_acr"]])['course'] }}</p>
                                                        <!--<p>Year: {{ courseDict["course_year"] }}</p>-->
                                                        <p>{{ matchVenue(courseDict["course_details"]) }}</p>

                                                    {% endif %}
                                                </div>


                                                <!-- Modal -->

                                                <div class="modal fade"
                                                     id="{{ courseDict['course_acr'] + '-' + day }}-modal"
                                                     tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

                                                    <script>


                                                        var {{courseDict["course_acr"]+day}}Coordinates = {{ matchNameInJsonToLongLat(UOE_VENUE_DATA, mostSimilar(UOE_VENUE_DATA, matchVenue(courseDict["course_details"]))) }};
                                                        {#                                                    alert({{courseDict["course_acr"]+day}}Coordinates)#}

                                                        $('#{{  courseDict["course_acr"] + "-" + day  }}-modal').on('shown.bs.modal', function () {

                                                            var {{  courseDict["course_acr"] + day  }}Map = new mapboxgl.Map({
                                                                container: '{{  courseDict["course_acr"] + "-" + day  }}-map',
                                                                style: 'mapbox://styles/mapbox/streets-v9',
                                                                zoom: 16,
                                                                center: {{ courseDict["course_acr"] + day }}Coordinates
                                                            });


                                                            var {{courseDict["course_acr"] + day}}Directions = new MapboxDirections({
                                                                accessToken: mapboxgl.accessToken,
                                                                profile: 'mapbox.walking',
                                                                unit: 'metric'
                                                            });

                                                            {{courseDict["course_acr"] + day}}Map.addControl({{courseDict["course_acr"] + day}}Directions, 'top-left');
                                                            {{courseDict["course_acr"] + day}}Directions.setDestination({{ courseDict["course_acr"] + day }}Coordinates)


                                                            // Markers
                                                            {{  courseDict["course_acr"] + day  }}Map.on('load', function () {

                                                                {{  courseDict["course_acr"] + day  }}Map.addSource("markers", {
                                                                    "type": "geojson",
                                                                    "data": {
                                                                        "type": "FeatureCollection",
                                                                        "features": [{
                                                                            "type": "Feature",
                                                                            "geometry": {
                                                                                "type": "Point",
                                                                                "coordinates": {{ matchNameInJsonToLongLat(UOE_VENUE_DATA, mostSimilar(UOE_VENUE_DATA, matchVenue(courseDict["course_details"]))) }}
                                                                            },
                                                                            "properties": {
                                                                                "title": "Mapbox DC",
                                                                                "marker-symbol": "default_marker"
                                                                            }
                                                                        }]
                                                                    }
                                                                });

                                                                {{  courseDict["course_acr"] + day  }}Map.addLayer({
                                                                    "id": "markers",
                                                                    "source": "markers",
                                                                    "type": "circle",
                                                                    "paint": {
                                                                        "circle-radius": 10,
                                                                        "circle-color": "#007cbf"
                                                                    }
                                                                });

                                                                {#                                                            {{  courseDict["course_acr"] + day  }}Map.addLayer({#}
                                                                {#                                                                "id": "markers",#}
                                                                {#                                                                "type": "symbol",#}
                                                                {#                                                                "source": {#}
                                                                {#                                                                    "type": "geojson",#}
                                                                {#                                                                    "data": {#}
                                                                {#                                                                        "type": "FeatureCollection",#}
                                                                {#                                                                        "features": [{#}
                                                                {#                                                                            "type": "Feature",#}
                                                                {#                                                                            "geometry": {#}
                                                                {#                                                                                "type": "Point",#}
                                                                {#                                                                                "coordinates": {{ courseDict["course_acr"] + day }}Coordinates#}
                                                                {#                                                                                "coordinates": {{ matchNameInJsonToLongLat(UOE_VENUE_DATA, mostSimilar(UOE_VENUE_DATA, matchVenue(courseDict["course_details"]))) }} {#{{ courseDict["course_acr"] + day }}Coordinates#}
                                                                {#                                                                            },#}
                                                                {#                                                                            "properties": {#}
                                                                {#                                                                                "title": "Help Me",#}
                                                                {#                                                                                "icon": "marker"#}
                                                                {#                                                                                "marker-symbol": "default_marker"#}
                                                                {#                                                                            }#}
                                                                {#                                                                        }]#}
                                                                {#                                                                    }#}
                                                                {#                                                                },#}
                                                                {#                                                                "layout": {#}
                                                                {#                                                                    "icon-image": "{icon}-15",#}
                                                                {#                                                                    "text-field": "{title}",#}
                                                                {#                                                                    "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],#}
                                                                {#                                                                    "text-offset": [0, 0.6],#}
                                                                {#                                                                    "text-anchor": "top"#}
                                                                {#                                                                }#}
                                                                {#                                                            });#}


                                                            })
                                                            ;


                                                        });


                                                    </script>

                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal"
                                                                        aria-label="Close"><span
                                                                        aria-hidden="true">&times;</span>
                                                                </button>
                                                                <h4 class="modal-title" id="myModalLabel">
                                                                    {% if courseDict["course_acr"] in COURSE_DICT %}
                                                                        <h2>{{ (COURSE_DICT[courseDict["course_acr"]])['course'] }}</h2>


                                                                    {% endif %}</h4>
                                                            </div>


                                                            <div class="modal-body">
                                                                {% if courseDict["course_acr"] in COURSE_DICT %}
                                                                    <div class="course-details">
                                                                        <div class="col-md-4 row course-details-container">
                                                                            <a target="_blank"
                                                                               href="{% if courseDict['course_acr'] in COURSE_DICT %}
                                                                                                            {{ (COURSE_DICT[courseDict['course_acr']])['course_url'] }}
                                                                                                            {% endif %}
                                                                                                            ">
                                                                                <div class="course-details well well-sm modal-well col-sm-4">
                                                                                    <p class="big-icon homepage-icon"><span
                                                                                            class="glyphicon glyphicon-home"></span>
                                                                                    </p>
                                                                                    <p class="homepage-text">
                                                                                        HOMEPAGE</p>
                                                                                </div>
                                                                            </a>
                                                                            <div class="course-details well well-sm modal-well col-sm-4">
                                                                                <p class="big-icon">{{ COURSE_DICT[courseDict["course_acr"]]['year'] }}</p>
                                                                                <p>YEAR</p>
                                                                            </div>
                                                                            <div class="course-details well well-sm modal-well col-sm-4">
                                                                                <p class="big-icon">{{ COURSE_DICT[courseDict["course_acr"]]['credits'] }}</p>
                                                                                <p>CREDITS</p>
                                                                            </div>
                                                                            <a target="_blank"
                                                                               href="{% if courseDict['course_acr'] in COURSE_DICT %}
                                                                                                            {{ (COURSE_DICT[courseDict['course_acr']])['drps'] }}
                                                                                                            {% endif %}
                                                                                                            ">
                                                                                <div class="course-details well well-sm modal-well col-sm-4">
                                                                                    <p class="big-icon homepage-icon"><span
                                                                                            class="glyphicon glyphicon-home"></span>
                                                                                    </p>
                                                                                    <p class="homepage-text">DRPS</p>
                                                                                </div>
                                                                            </a>

                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <p><span
                                                                                    class="glyphicon glyphicon-time"></span> {{ day }}, {{ TIMES_LIST[loop.index] }}
                                                                            </p>
                                                                            <p>
                                                                                <img id="door" src="{{ url_for('static', filename='img/door.svg') }}">
                                                                                 {{ courseDict["course_room"] }}
                                                                            </p>
                                                                            <p><i class="fa fa-bank"></i> {{ mostSimilar(UOE_VENUE_DATA,
                                                            matchVenue(courseDict["course_details"])) }}</p>
                                                                            <p><span
                                                                                    class="glyphicon glyphicon-map-marker"></span> {{ matchNameInJsonToDict(UOE_VENUE_DATA,
                                                            mostSimilar(UOE_VENUE_DATA,
                                                            matchVenue(courseDict["course_details"])))['address1'] }},
                                                                                {{ matchNameInJsonToDict(UOE_VENUE_DATA,
                                                            mostSimilar(UOE_VENUE_DATA,
                                                            matchVenue(courseDict["course_details"])))['postcode'] }}
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                    <div id="{{ courseDict['course_acr'] + '-' + day }}-map"
                                                                         class='map'></div>
                                                                {% endif %}
                                                                <!--<a target="_blank" href="
                                                                    {% if courseAcr in COURSE_DICT %}-->
                                                                    <!--{{(COURSE_DICT[courseAcr])['course_url']}}-->
                                                                    <!--{% endif %}-->
                                                                <!--"><span class="glyphicon glyphicon-home"></span>-->
                                                                <!--</a>-->

                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-default"
                                                                        data-dismiss="modal">
                                                                    Close
                                                                </button>
                                                                <!--<button type="button" class="btn btn-primary">Save changes</button>-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                            {% endfor %}
                                        </td>
                                    </div>
                                {% endfor %}
                            </tr>
                        {% endfor %}

                        </tbody>
                    </table>
                </div>
            {% endfor %}

        </div>

    </div>


</div>


</div>
</body>
</html>
